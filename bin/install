#!/bin/bash
set -e

basename=`dirname $0`
cd "${basename}/.."

if [ "$1" == "clean" ]; then
  echo Removing old packages so we fetch everything from scratch
  for i in . packages/backend-api packages/frontend-web; do
    rm -Rf ${i}/node_modules ${i}/package-lock.json
  done
fi

# Get packages for the root of the system, in particular lerna
npm install

# Use lerna to link together sub-modules, then build
./bin/link-packages
./bin/build

#!/bin/bash
set -e

basename=`dirname $0`
cd "${basename}/.."

if [ "$1" == "clean" ]; then
  echo Removing old packages so we fetch everything from scratch
  rm -Rf node_modules package-lock.json
fi

# Get packages for the root of the system, in particular lerna
NODE_ENV=development npm install

# Use lerna to link together sub-modules, then build
./bin/link-packages
./bin/build
